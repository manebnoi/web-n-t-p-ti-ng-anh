<!DOCTYPE html>
<html lang="en" translate="no">
<head>
  <meta charset="UTF-8" />
  <meta name="google" content="notranslate" />
  <title>English Tech - Middle School Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary-cyan: #22d3ee;
      --primary-indigo: #6366f1;
      --bg-dark: #0f172a;
      --card-bg: rgba(30, 41, 59, 0.8);
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at center, #1e1b4b, #0f172a);
      color: #f8fafc;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none; /* H·∫°n ch·∫ø copy ƒë·ªÉ d·ªãch */
    }

    .container {
      width: 90%;
      max-width: 800px;
      margin-top: 30px;
    }

    h1 {
      text-align: center;
      color: var(--primary-cyan);
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 15px rgba(34, 211, 238, 0.5);
    }

    .card {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    /* Form & Input */
    input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #334155;
      background: #020617;
      color: white;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      padding: 15px;
      margin-top: 15px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(90deg, var(--primary-cyan), var(--primary-indigo));
      color: #020617;
      font-weight: bold;
      text-transform: uppercase;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
    }

    /* Game UI */
    .stats-bar {
      display: flex;
      justify-content: space-between;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 20px;
      border-radius: 50px;
      margin-bottom: 20px;
      font-weight: bold;
      border: 1px solid var(--primary-cyan);
    }

    .question-box { margin-bottom: 20px; }
    .section-label { color: var(--primary-cyan); font-size: 0.9rem; }

    .choice {
      background: #334155;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.2s;
    }

    .choice:hover { background: #475569; border-left: 5px solid var(--primary-cyan); }

    .hidden { display: none; }

    #leaderboard-list {
      list-style: none;
      padding: 0;
    }

    #leaderboard-list li {
      background: rgba(255, 255, 255, 0.05);
      margin: 5px 0;
      padding: 10px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
    }

    .gem-icon { color: #facc15; }
  </style>
</head>
<body translate="no">

  <audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" type="audio/mpeg">
  </audio>

  <div class="container">
    <h1>TECH ENGLISH</h1>

    <div id="login-screen" class="card">
      <h2 style="text-align: center;">Ready to Start?</h2>
      <input type="text" id="player-name" placeholder="Full Name..." required>
      <input type="text" id="player-class" placeholder="Class (e.g., 8A1)..." required>
      <button onclick="initGame()">Login & Play</button>
      <button style="background: #475569; color: white;" onclick="toggleMusic()">üéµ Toggle Music</button>
    </div>

    <div id="game-screen" class="card hidden">
      <div class="stats-bar">
        <span>üïí <span id="timer">25:00</span></span>
        <span>‚≠ê <span id="score">0</span></span>
        <span>üíé <span id="gems">0</span></span>
      </div>
      
      <div class="question-box">
        <div class="section-label" id="section-name">SECTION</div>
        <h3 id="question-text">Question loading...</h3>
        <div id="options-container"></div>
      </div>
      <div style="text-align: right; font-size: 0.8rem; opacity: 0.7;">
        Progress: <span id="progress">1</span>/20 (Level <span id="level-num">1</span>)
      </div>
    </div>

    <div id="result-screen" class="card hidden">
      <h2 style="text-align: center; color: var(--primary-cyan);">MISSION COMPLETE! üèÜ</h2>
      <div style="text-align: center; font-size: 1.2rem;">
        <p>Player: <span id="res-name"></span></p>
        <p>Total Score: <span id="res-score"></span></p>
        <p>Gems Earned: <span id="res-gems" class="gem-icon"></span> üíé</p>
      </div>
      <button onclick="location.reload()">Play New Round</button>
    </div>

    <div class="card" style="margin-top: 20px;">
      <h3 style="margin-top: 0; color: var(--primary-cyan);">üèÜ Leaderboard</h3>
      <ul id="leaderboard-list"></ul>
    </div>
  </div>

<script>
/* DATABASE M√î PH·ªéNG (H·ªçc sinh THCS)
   Trong th·ª±c t·∫ø, 1000 c√¢u s·∫Ω ƒë∆∞·ª£c t·∫£i t·ª´ file JSON b√™n ngo√†i.
   ·ªû ƒë√¢y t√¥i t·∫°o h√†m generate ng·∫´u nhi√™n d·ª±a tr√™n c·∫•u tr√∫c y√™u c·∫ßu.
*/

const SECTION_NAMES = [
  "Word Arrangement (S·∫Øp x·∫øp t·ª´)",
  "Multiple Choice (Ch·ªçn ƒë√°p √°n ƒë√∫ng)",
  "Error Identification (T√¨m l·ªói sai)",
  "Sentence Correction (S·ª≠a c√¢u)"
];

let database = [];
function createDatabase() {
  for(let s=0; s<4; s++) {
    for(let i=0; i<250; i++) {
      database.push({
        id: s * 250 + i,
        section: SECTION_NAMES[s],
        question: `[Level ${s+1}] Grade 6-9 English Challenge Question #${i+1}?`,
        options: ["Correct Answer Option", "Wrong Option B", "Wrong Option C", "Wrong Option D"],
        answer: 0 // V·ªã tr√≠ 0 lu√¥n ƒë√∫ng trong database n√†y (s·∫Ω tr·ªôn khi hi·ªÉn th·ªã)
      });
    }
  }
}

// Game State
let currentPlayer = { name: "", class: "", score: 0, gems: 0 };
let currentSessionQuestions = [];
let currentIndex = 0;
let timeRemaining = 1500; // 25 ph√∫t
let gameInterval;

function initGame() {
  const name = document.getElementById('player-name').value;
  const cls = document.getElementById('player-class').value;
  if(!name || !cls) return alert("Please enter info!");

  currentPlayer.name = name;
  currentPlayer.class = cls;
  
  createDatabase();
  // Ch·ªçn ng·∫´u nhi√™n 20 c√¢u m·ªói l·∫ßn ch∆°i
  currentSessionQuestions = database.sort(() => 0.5 - Math.random()).slice(0, 20);
  
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  
  startTimer();
  loadQuestion();
}

function loadQuestion() {
  const q = currentSessionQuestions[currentIndex];
  document.getElementById('section-name').textContent = q.section;
  document.getElementById('question-text').textContent = q.question;
  document.getElementById('progress').textContent = currentIndex + 1;
  document.getElementById('level-num').textContent = Math.floor(currentIndex / 5) + 1;

  const container = document.getElementById('options-container');
  container.innerHTML = '';

  // Tr·ªôn ƒë√°p √°n
  let choices = [...q.options];
  let correctText = choices[q.answer];
  choices = choices.sort(() => 0.5 - Math.random());

  choices.forEach(text => {
    const div = document.createElement('div');
    div.className = 'choice';
    div.textContent = text;
    div.onclick = () => checkAnswer(text === correctText);
    container.appendChild(div);
  });
}

function checkAnswer(isCorrect) {
  if(isCorrect) {
    currentPlayer.score += 50;
    currentPlayer.gems += 2;
    currentIndex++;
    if(currentIndex >= currentSessionQuestions.length) {
      endGame();
    } else {
      loadQuestion();
    }
  } else {
    alert("Wrong! You get a different question to try again.");
    // ƒê·ªïi c√¢u h·ªèi hi·ªán t·∫°i b·∫±ng m·ªôt c√¢u ng·∫´u nhi√™n kh√°c t·ª´ database
    currentSessionQuestions[currentIndex] = database[Math.floor(Math.random()*database.length)];
    loadQuestion();
  }
  updateStats();
}

function updateStats() {
  document.getElementById('score').textContent = currentPlayer.score;
  document.getElementById('gems').textContent = currentPlayer.gems;
}

function startTimer() {
  gameInterval = setInterval(() => {
    timeRemaining--;
    let mins = Math.floor(timeRemaining / 60);
    let secs = timeRemaining % 60;
    document.getElementById('timer').textContent = 
      `${mins}:${secs.toString().padStart(2, '0')}`;

    if(timeRemaining <= 0) {
      clearInterval(gameInterval);
      alert("Time is up! Let's try a new set.");
      location.reload();
    }
  }, 1000);
}

function endGame() {
  clearInterval(gameInterval);
  document.getElementById('game-screen').classList.add('hidden');
  document.getElementById('result-screen').classList.remove('hidden');
  
  document.getElementById('res-name').textContent = currentPlayer.name;
  document.getElementById('res-score').textContent = currentPlayer.score;
  document.getElementById('res-gems').textContent = currentPlayer.gems;

  saveLeaderboard();
}

function saveLeaderboard() {
  let board = JSON.parse(localStorage.getItem('eng_leaderboard') || '[]');
  board.push({name: currentPlayer.name, score: currentPlayer.score, class: currentPlayer.class});
  board.sort((a, b) => b.score - a.score);
  board = board.slice(0, 5); // Gi·ªØ top 5
  localStorage.setItem('eng_leaderboard', JSON.stringify(board));
  displayLeaderboard();
}

function displayLeaderboard() {
  const board = JSON.parse(localStorage.getItem('eng_leaderboard') || '[]');
  const list = document.getElementById('leaderboard-list');
  list.innerHTML = board.map(item => 
    `<li><span>${item.name} (${item.class})</span> <b>${item.score} pts</b></li>`
  ).join('');
}

function toggleMusic() {
  const audio = document.getElementById('bgMusic');
  if (audio.paused) audio.play();
  else audio.pause();
}

// Ch·∫∑n chu·ªôt ph·∫£i (h·∫°n ch·∫ø c√¥ng c·ª• d·ªãch)
document.addEventListener('contextmenu', event => event.preventDefault());

displayLeaderboard();
</script>
</body>
</html>
